<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styleIndex.css"/>
    <link rel="stylesheet" href="styles/companiesStyle.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@600&display=swap" rel="stylesheet">
    <title>Formulario de empresas</title>
    
</head>
<header>
    <nav id="menu">
        <button id="home"><a id="homeA" href="index.html">Inicio</a></button>
        <a href="https://github.com/AlanDouglasASouza"><img id="github" src="https://img.icons8.com/fluency-systems-regular/48/000000/github.png"></img></a>
        <a href="https://www.linkedin.com/in/alan-douglas-artigas-souza"><img id="linkedin" src="https://img.icons8.com/ios-filled/50/000000/linkedin.png"></img></a>
        <a href="https://t.me/alanDouglasASouza"><img id="telegram" src="https://img.icons8.com/ios/50/000000/telegram-app.png"></img></a>
        <input type="search" id="pesquisar" placeholder="Pesquisar por CNPJ">
        <button id="searchBt" onclick="search()">
            <img id="search"src="https://img.icons8.com/ios/50/000000/search--v1.png"/>
        </button>         
        <button id="btCadastros"><a href="companies.html">Cadastros</a></button>
    </nav>    
</header>
<body>
    <div id="bod">
        <h1 id="iu">Resultado da Pesquisa: </h1>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
<script src="companiesScript.js"></script>
<script>    
    window.onload = () => {

        // Pegando o parÃ¢metro de cnpj da url
        const urlParams = new URLSearchParams(window.location.search);
        const getCnpj = urlParams.get('cnpj');

        // Consultando a API com o parametro cnpj para retornar a pesquisa       
        try {
            oneCompany(getCnpj);
        } catch (err) {
            console.error(`Erro ao procurar cadastro: ${err}`);
        }        
    } 

    // Consultando a API com o parametro cnpj para retornar a pesquisa de um registro
    const oneCompany = async (cnpj) => {
        const title = document.getElementById('iu');
        try {            
            const result = await fetch(`http://localhost:8080/findOneCompany/${cnpj}`);
            const data = await result.json();                       
                creates({
                    name: data.name,
                    cnpj: '00000000/00',
                    phone: '0444444444',
                    insta: 'insta alguma coisa',
                    email: 'um.mail.com',
                    adress: 'algum lugar',
                    complement: 'alguma coisa',
                    causes: 'food',
                    director: 'Alguem',
                    abstract: 'ajdhnasdsanbkask',
                    inscEs: '415644163464',
                    inscMu: '326323625232',
                    face: 'facekjksn',
                    site: 'www.lololo.com',
                    photo: data.photoCompany
                })            
        } catch (err) {
            console.error(`Erro ao consultar API: ${err}`);
            title.innerHTML = 'Nenhum resultado encontrado :('
        }
    }    

</script>